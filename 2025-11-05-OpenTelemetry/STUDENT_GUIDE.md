# OpenTelemetry with Kubernetes - Student Guide

## Table of Contents
1. [Introduction](#introduction)
2. [Learning Objectives](#learning-objectives)
3. [Prerequisites](#prerequisites)
4. [What is OpenTelemetry?](#what-is-opentelemetry)
5. [Architecture Overview](#architecture-overview)
6. [Step-by-Step Lab Instructions](#step-by-step-lab-instructions)
7. [Understanding the Components](#understanding-the-components)
8. [Testing the Application](#testing-the-application)
9. [Viewing Telemetry Data](#viewing-telemetry-data)
10. [Troubleshooting](#troubleshooting)
11. [Cleanup](#cleanup)
12. [Key Takeaways](#key-takeaways)

---

## Introduction

This lab will guide you through setting up OpenTelemetry in a Kubernetes environment using Minikube. You will learn how to:

- Deploy an auto-instrumented FastAPI application
- Configure an OpenTelemetry Collector
- Observe telemetry data (traces, metrics, and logs) in real-time
- Understand the flow of telemetry data through the system

---

## Learning Objectives

By the end of this lab, you will be able to:

1. **Understand OpenTelemetry concepts**: Learn what telemetry data is and why it's important
2. **Deploy applications with OpenTelemetry**: Configure auto-instrumentation for a Python application
3. **Set up OpenTelemetry Collector**: Configure and deploy a collector in Kubernetes
4. **Observe telemetry data**: View traces, metrics, and logs generated by your application
5. **Understand Kubernetes services**: Learn about NodePort and ClusterIP services

---

## Prerequisites

Before starting this lab, ensure you have the following installed and configured:

### Required Software

1. **Docker** (version 20.10 or later)
   - Installation guide: https://docs.docker.com/get-docker/
   - Verify installation: `docker --version`

2. **Minikube** (version 1.28 or later)
   - Installation guide: https://minikube.sigs.k8s.io/docs/
   - Verify installation: `minikube version`

3. **kubectl** (Kubernetes command-line tool)
   - Installation guide: https://kubernetes.io/docs/tasks/tools/
   - Verify installation: `kubectl version --client`

4. **Git**
   - Installation guide: https://git-scm.com/downloads
   - Verify installation: `git --version`

### System Requirements

- At least 2 CPUs
- At least 2GB of free memory
- At least 20GB of free disk space
- Internet connection for downloading images

---

## What is OpenTelemetry?

**OpenTelemetry** is an open-source observability framework that provides a standardized way to collect, process, and export telemetry data (traces, metrics, and logs) from your applications.

### Key Concepts

1. **Telemetry Data Types**:
   - **Traces**: Show the path a request takes through your system
   - **Metrics**: Numerical measurements of system performance
   - **Logs**: Textual records of events

2. **Auto-Instrumentation**: Automatically adds observability to your application without modifying code

3. **OpenTelemetry Collector**: A component that receives, processes, and exports telemetry data

4. **OTLP (OpenTelemetry Protocol)**: The standard protocol for sending telemetry data

### Why Use OpenTelemetry?

- **Vendor-neutral**: Works with multiple observability backends
- **Standardized**: Provides consistent telemetry across different languages and frameworks
- **Auto-instrumentation**: Minimal code changes required
- **Flexible**: Can send data to multiple backends simultaneously

---

## Architecture Overview

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Minikube Kubernetes Cluster              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           opentelemetry-demo Namespace                 â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚  FastAPI App     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  OTEL Collector  â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  (Port 8000)     â”‚  OTLP   â”‚  (Port 4317)     â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚         â”‚                                              â”‚ â”‚
â”‚  â”‚         â”‚ NodePort Service (Port 30000)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚                                                â”‚
â”‚            â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           External Access (Port 30000)                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Flow

1. **User Request**: User accesses the application via NodePort service (port 30000)
2. **Application Processing**: FastAPI application processes the request
3. **Telemetry Generation**: Application auto-generates traces, metrics, and logs
4. **Telemetry Export**: Application sends telemetry data to the collector via OTLP
5. **Collector Processing**: Collector receives, processes, and logs the telemetry data

---

## Step-by-Step Lab Instructions

### Step 1: Prepare Minikube Environment

First, we need to ensure we have a clean Minikube environment. If you have an existing Minikube cluster, delete it and start fresh.

#### 1.1 Delete Existing Minikube Cluster (if any)

```bash
minikube delete
```

**What this does**: Removes any existing Minikube cluster and all associated resources. This ensures a clean start.

**Expected Output**: 
```
ğŸ”¥  Deleting "minikube" in docker ...
ğŸ’€  Removed all traces of the "minikube" cluster.
```

#### 1.2 Start a New Minikube Cluster

```bash
minikube start
```

**What this does**: 
- Creates a new single-node Kubernetes cluster
- Downloads the Kubernetes images if needed
- Starts the cluster with default settings

**Expected Output**:
```
ğŸ˜„  minikube v1.32.0 on Ubuntu 22.04
âœ¨  Automatically selected the docker driver
ğŸ“¦  Downloading Kubernetes v1.28.3 preload ...
ğŸ”¥  Creating docker container (CPUs=2, Memory=4000mb) ...
ğŸ³  Preparing Kubernetes v1.28.3 on Docker 24.0.7 ...
âœ…  Verifying Kubernetes components...
âœ…  Using image gcr.io/k8s-minikube/storage-provisioner:v5
ğŸ‰  Starting control plane node minikube in cluster minikube
âœ…  kubectl not found. Using minikube kubectl -- 
âœ…  Waiting for it to be ready ...
```

**Verification**: Check that Minikube is running:
```bash
minikube status
```

Expected output should show:
```
minikube
type: Control Plane
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured
```

---

### Step 2: Clone the Repository

Navigate to your projects directory and clone the OpenTelemetry experiments repository.

```bash
cd ~/projects
git clone https://github.com/rutu-sh/otel-k8s-experiments
```

**What this does**: 
- Downloads the repository containing the Kubernetes manifests and example applications
- This repository contains all the YAML files needed for this lab

**Expected Output**:
```
Cloning into 'otel-k8s-experiments'...
remote: Enumerating objects: 317, done.
remote: Counting objects: 100% (317/317), done.
remote: Compressing objects: 100% (218/218), done.
remote: Total 317 (delta 95), reused 218 (delta 47), pack-reused 0 (from 0)
Receiving objects: 100% (317/317), 28.86 MiB | 13.28 MiB/s, done.
Resolving deltas: 100% (95/95), done.
```

**Verification**: Check that the repository was cloned successfully:
```bash
ls -la otel-k8s-experiments/
```

You should see directories like `experiments/`, `common-applications/`, etc.

---

### Step 3: Navigate to the Experiment Directory

Change to the directory containing the Kubernetes manifests for the single-app-single-collector experiment.

```bash
cd otel-k8s-experiments/experiments/single-app-single-collector/k8s
```

**What this directory contains**:
- `namespace.yaml`: Creates the opentelemetry-demo namespace
- `configmap.yaml`: Contains environment variables for the application
- `service.yaml`: Defines the NodePort and ClusterIP services
- `deployment.yaml`: Defines the application and collector deployments
- `kustomization.yaml`: Kustomize configuration for managing resources
- `data/otel-collector-config.yaml`: Collector configuration

---

### Step 4: Deploy the Application and Collector

Deploy all the Kubernetes resources using kubectl's built-in kustomize support.

```bash
kubectl apply -k .
```

**What this does**: 
- Applies all Kubernetes resources defined in the kustomization.yaml
- Creates the namespace, configmaps, services, and deployments
- The `-k` flag tells kubectl to use kustomize to process the directory

**Expected Output**:
```
namespace/opentelemetry-demo created
configmap/otel-collector-config created
configmap/single-app-single-collector created
service/otel-collector created
service/single-app-single-collector created
deployment.apps/opentelemetry-collector created
deployment.apps/single-app-single-collector created
```

**What was created**:
1. **Namespace**: `opentelemetry-demo` - Isolates our resources
2. **ConfigMaps**: 
   - `otel-collector-config`: Collector configuration
   - `single-app-single-collector`: Application environment variables
3. **Services**:
   - `otel-collector`: ClusterIP service for the collector (internal)
   - `single-app-single-collector`: NodePort service for the app (external access)
4. **Deployments**:
   - `opentelemetry-collector`: Runs the OpenTelemetry Collector
   - `single-app-single-collector`: Runs the FastAPI application

---

### Step 5: Verify Deployments

Check that all deployments are running successfully.

```bash
kubectl get deployment -n opentelemetry-demo
```

**What this does**: Lists all deployments in the opentelemetry-demo namespace

**Expected Output**:
```
NAME                          READY   UP-TO-DATE   AVAILABLE   AGE
opentelemetry-collector       1/1     1            1           83s
single-app-single-collector   1/1     1            1           83s
```

**Understanding the Output**:
- **NAME**: Name of the deployment
- **READY**: Shows current ready replicas / desired replicas (e.g., 1/1 means 1 pod is ready out of 1 desired)
- **UP-TO-DATE**: Number of pods updated to match the desired state
- **AVAILABLE**: Number of pods available to serve traffic
- **AGE**: How long the deployment has been running

**Important**: Wait until both deployments show `1/1` in the READY column. If pods are still starting, wait a few seconds and check again.

---

### Step 6: Verify All Resources

Get a comprehensive view of all resources in the cluster.

```bash
kubectl get all -A
```

**What this does**: Lists all resources (pods, services, deployments, etc.) across all namespaces

**Expected Output**:
```
NAMESPACE            NAME                                               READY   STATUS    RESTARTS      AGE
kube-system          pod/coredns-66bc5c9577-k5mwb                       1/1     Running   0             43m
kube-system          pod/etcd-minikube                                  1/1     Running   0             43m
kube-system          pod/kube-apiserver-minikube                        1/1     Running   0             43m
kube-system          pod/kube-controller-manager-minikube               1/1     Running   0             43m
kube-system          pod/kube-proxy-b6pst                               1/1     Running   0             43m
kube-system          pod/kube-scheduler-minikube                        1/1     Running   0             43m
kube-system          pod/storage-provisioner                            1/1     Running   0             1 (42m ago)   43m
opentelemetry-demo   pod/opentelemetry-collector-86944cc7f-9844n        1/1     Running   0             2m39s
opentelemetry-demo   pod/single-app-single-collector-5fccfd678b-tlj64   1/1     Running   0             2m39s

NAMESPACE            NAME                                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE
default              service/kubernetes                    ClusterIP   10.96.0.1       <none>        443/TCP                  43m
kube-system          service/kube-dns                      ClusterIP   10.96.0.10      <none>        53/UDP,53/TCP,9153/TCP   43m
opentelemetry-demo   service/otel-collector                ClusterIP   10.109.51.221   <none>        4317/TCP                 2m39s
opentelemetry-demo   service/single-app-single-collector   NodePort    10.104.23.173   <none>        8000:30000/TCP           2m39s

NAMESPACE     NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
kube-system   daemonset.apps/kube-proxy   1         1         1       1            1           kubernetes.io/os=linux   43m

NAMESPACE            NAME                                          READY   UP-TO-DATE   AVAILABLE   AGE
kube-system          deployment.apps/coredns                       1/1     1            1           43m
opentelemetry-demo   deployment.apps/opentelemetry-collector       1/1     1            1           2m39s
opentelemetry-demo   deployment.apps/single-app-single-collector   1/1     1            1           2m39s

NAMESPACE            NAME                                                     DESIRED   CURRENT   READY   AGE
kube-system          replicaset.apps/coredns-66bc5c9577                       1         1        1       43m
opentelemetry-demo   replicaset.apps/opentelemetry-collector-86944cc7f        1         1        1       2m39s
opentelemetry-demo   replicaset.apps/single-app-single-collector-5fccfd678b   1         1        1       2m39s
```

**Understanding the Output**:

**Pods** (in opentelemetry-demo namespace):
- `opentelemetry-collector-86944cc7f-9844n`: The collector pod
- `single-app-single-collector-5fccfd678b-tlj64`: The application pod

**Services** (in opentelemetry-demo namespace):
- `otel-collector`: ClusterIP service (10.109.51.221:4317) - Internal only
- `single-app-single-collector`: NodePort service (10.104.23.173:8000) - Exposed on port 30000

**Key Observation**: The `single-app-single-collector` service shows `8000:30000/TCP`, which means:
- Port 8000 inside the cluster
- Port 30000 on the node (accessible from outside)

---

### Step 7: Access the Application

Open the application in your browser using Minikube's service command.

```bash
minikube service single-app-single-collector -n opentelemetry-demo
```

**What this does**: 
- Opens the service URL in your default browser
- Shows the service details including the URL

**Expected Output**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     NAMESPACE      â”‚            NAME             â”‚ TARGET PORT â”‚            URL            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ opentelemetry-demo â”‚ single-app-single-collector â”‚ 8000        â”‚ http://192.168.49.2:30000 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ‰  Opening service opentelemetry-demo/single-app-single-collector in default browser...
Opening in existing browser session.
```

**Note**: Your IP address may differ (e.g., `192.168.49.2`). Use the URL shown in your output.

---

### Step 8: Access the API Documentation

The FastAPI application includes automatic API documentation. Access it at:

```
http://192.168.49.2:30000/docs
```

**What this shows**: 
- Interactive Swagger UI documentation
- All available API endpoints
- Ability to test endpoints directly from the browser

**Alternative URL**: You can also access ReDoc format at:
```
http://192.168.49.2:30000/redoc
```

---

## Testing the Application

### Creating a Record with POST

Now that the application is running, let's create some telemetry data by making API requests.

#### Option 1: Using the Swagger UI

1. Navigate to `http://192.168.49.2:30000/docs` in your browser
2. Find the POST endpoint (usually `/items/` or similar)
3. Click "Try it out"
4. Enter a JSON payload, for example:
   ```json
   {
     "name": "Test Item",
     "description": "This is a test item"
   }
   ```
5. Click "Execute"

#### Option 2: Using curl

If you prefer the command line, you can use curl:

```bash
curl -X POST "http://192.168.49.2:30000/items/" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Item",
    "description": "This is a test item"
  }'
```

**What this does**: 
- Sends a POST request to create a new item
- The application processes the request
- OpenTelemetry auto-instrumentation generates telemetry data (traces, metrics, logs)
- The telemetry data is sent to the collector

**Expected Response**: You should receive a JSON response with the created item, including an ID.

---

## Viewing Telemetry Data

### View Application Logs

Check the logs from the application pod to see application-level logs.

```bash
kubectl get pod -n opentelemetry-demo
```

First, get the pod name, then view its logs:

```bash
kubectl logs single-app-single-collector-5fccfd678b-tlj64 -n opentelemetry-demo
```

**Note**: Replace `single-app-single-collector-5fccfd678b-tlj64` with your actual pod name from the `kubectl get pod` output.

**What you'll see**: 
- Application startup logs
- Request handling logs
- Any application errors or warnings

---

### View Collector Logs

The collector logs show the telemetry data received from the application. This is where you'll see traces, metrics, and logs.

```bash
kubectl logs opentelemetry-collector-86944cc7f-9844n -n opentelemetry-demo
```

**Note**: Replace `opentelemetry-collector-86944cc7f-9844n` with your actual pod name.

**What you'll see**: 
- **Traces**: Showing the request flow through your application
- **Metrics**: Performance measurements (request duration, count, etc.)
- **Logs**: Structured log entries from your application

**Example Output**:
```
2024-01-15T10:30:45.123Z    info    TracesExporter  {"kind": "exporter", "data_type": "traces", "name": "logging"}
ResourceSpans #0
Resource SchemaURL: 
Resource attributes:
     -> service.name: STRING(single-app-single-collector-fastapi-app)
     -> service.version: STRING(1.0.0)
InstrumentationScopeSpans #0
InstrumentationScope opentelemetry.instrumentation.fastapi 0.39b0
Span #0
    Trace ID       : 1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d
    Parent ID      : 
    ID             : 2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e
    Name           : POST /items/
    Kind           : SPAN_KIND_SERVER
    Start time     : 2024-01-15 10:30:45.000 +0000 UTC
    End time       : 2024-01-15 10:30:45.123 +0000 UTC
    Status code    : STATUS_CODE_OK
    Status message : 
```

**Understanding the Output**:
- **Trace ID**: Unique identifier for the request trace
- **Span ID**: Unique identifier for this operation
- **Name**: The operation name (e.g., "POST /items/")
- **Kind**: Type of span (SERVER, CLIENT, etc.)
- **Start/End time**: When the operation started and ended
- **Status code**: Whether the operation succeeded

---

### Follow Logs in Real-Time

To see logs as they happen, use the `-f` flag:

```bash
kubectl logs -f opentelemetry-collector-86944cc7f-9844n -n opentelemetry-demo
```

**What this does**: 
- Follows (streams) the logs in real-time
- Press `Ctrl+C` to stop following

**Best Practice**: 
1. Open a terminal window
2. Run the follow command for the collector
3. Make API requests in another terminal or browser
4. Watch the telemetry data appear in real-time

---

## Understanding the Components

### 1. Namespace

The `opentelemetry-demo` namespace isolates our resources from other Kubernetes resources. This is a best practice for organization and resource management.

### 2. ConfigMaps

**Application ConfigMap** (`single-app-single-collector`):
- Contains environment variables for OpenTelemetry configuration
- Sets the service name, exporters, and collector endpoint
- Enables auto-instrumentation

**Collector ConfigMap** (`otel-collector-config`):
- Defines the collector's receivers, processors, and exporters
- Configures the OTLP receiver to listen on port 4317
- Sets up logging exporter to display telemetry data

### 3. Services

**NodePort Service** (`single-app-single-collector`):
- Exposes the application on port 30000
- Allows external access to the application
- Routes traffic to pods with label `app: single-app-single-collector`

**ClusterIP Service** (`otel-collector`):
- Internal service for the collector
- Only accessible within the cluster
- Application uses this to send telemetry data

### 4. Deployments

**Application Deployment**:
- Runs the FastAPI application
- Auto-instrumented with OpenTelemetry
- Sends telemetry to the collector via OTLP

**Collector Deployment**:
- Runs the OpenTelemetry Collector
- Receives telemetry via OTLP receiver
- Processes and exports telemetry data (currently to logs)

---

## Troubleshooting

### Problem: Pods are not ready

**Symptom**: `kubectl get pods` shows pods in `Pending` or `Error` state

**Solutions**:
1. Check pod status:
   ```bash
   kubectl describe pod <pod-name> -n opentelemetry-demo
   ```
2. Check pod logs:
   ```bash
   kubectl logs <pod-name> -n opentelemetry-demo
   ```
3. Ensure Minikube has enough resources:
   ```bash
   minikube status
   ```

### Problem: Cannot access the application

**Symptom**: Browser cannot connect to `http://192.168.49.2:30000`

**Solutions**:
1. Verify the service is running:
   ```bash
   kubectl get svc -n opentelemetry-demo
   ```
2. Get the correct URL:
   ```bash
   minikube service single-app-single-collector -n opentelemetry-demo --url
   ```
3. Check if Minikube is running:
   ```bash
   minikube status
   ```

### Problem: No telemetry data in collector logs

**Symptom**: Collector logs are empty or show no traces

**Solutions**:
1. Verify the application is sending telemetry:
   ```bash
   kubectl logs <app-pod-name> -n opentelemetry-demo
   ```
2. Check the collector configuration:
   ```bash
   kubectl get configmap otel-collector-config -n opentelemetry-demo -o yaml
   ```
3. Verify the application environment variables:
   ```bash
   kubectl get configmap single-app-single-collector -n opentelemetry-demo -o yaml
   ```
4. Make sure you've made some API requests to generate telemetry

### Problem: Images are not pulling

**Symptom**: Pods stuck in `ImagePullBackOff` or `ErrImagePull`

**Solutions**:
1. Check if Docker is running:
   ```bash
   docker ps
   ```
2. Try pulling the image manually:
   ```bash
   docker pull rutush10/otel-autoinstrumentation-fastapi-simple-app:0.0.4
   docker pull otel/opentelemetry-collector:0.33.0
   ```
3. Restart Minikube:
   ```bash
   minikube stop
   minikube start
   ```

---

## Cleanup

After completing the lab, clean up the resources to free up system resources.

### Option 1: Delete Only the Experiment Resources

```bash
cd ~/projects/devops/2025-11-05-OpenTelemetry/otel-k8s-experiments/experiments/single-app-single-collector/k8s
kubectl delete -k .
```

**What this does**: Removes all resources created for this experiment but keeps Minikube running

### Option 2: Delete the Entire Minikube Cluster

```bash
minikube delete
```

**What this does**: 
- Removes the entire Minikube cluster
- Frees up all resources
- Use this if you're done with all Kubernetes experiments

---

## Key Takeaways

### What You Learned

1. **OpenTelemetry Fundamentals**:
   - Understanding of telemetry data (traces, metrics, logs)
   - How auto-instrumentation works
   - The role of the OpenTelemetry Collector

2. **Kubernetes Concepts**:
   - Namespaces for resource isolation
   - Deployments for running applications
   - Services (NodePort and ClusterIP) for networking
   - ConfigMaps for configuration management

3. **Observability**:
   - How to view telemetry data in real-time
   - Understanding trace information
   - The flow of telemetry data through the system

### Next Steps

1. **Explore More**:
   - Try different API endpoints
   - Generate more telemetry data
   - Experiment with different collector configurations

2. **Learn More**:
   - Read the OpenTelemetry documentation: https://opentelemetry.io/docs/
   - Explore other experiments in the repository
   - Learn about exporting to different backends (Jaeger, Prometheus, etc.)

3. **Practice**:
   - Set up your own application with OpenTelemetry
   - Configure custom instrumentation
   - Export to different backends

### Common Use Cases

- **Application Monitoring**: Track application performance and errors
- **Distributed Tracing**: Understand request flow across microservices
- **Performance Optimization**: Identify bottlenecks in your application
- **Debugging**: Trace issues through your system

---

## Additional Resources

- [OpenTelemetry Documentation](https://opentelemetry.io/docs/)
- [Kubernetes Documentation](https://kubernetes.io/docs/)
- [Minikube Documentation](https://minikube.sigs.k8s.io/docs/)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)

---

## Lab Completion Checklist

- [ ] Successfully started Minikube cluster
- [ ] Cloned the otel-k8s-experiments repository
- [ ] Deployed all Kubernetes resources
- [ ] Verified deployments are running
- [ ] Accessed the application via browser
- [ ] Created at least one record via API
- [ ] Viewed application logs
- [ ] Viewed collector logs with telemetry data
- [ ] Understood the telemetry data structure
- [ ] Cleaned up resources

**Congratulations!** You have completed the OpenTelemetry with Kubernetes lab. You now have hands-on experience with observability in Kubernetes using OpenTelemetry.

